{"version":3,"sources":["uni-app:///main.js","webpack:///D:/百度网盘/wechat/pages/chat/chat/chat.vue?53f7","webpack:///D:/百度网盘/wechat/pages/chat/chat/chat.vue?a09b","webpack:///D:/百度网盘/wechat/pages/chat/chat/chat.vue?7aea","webpack:///D:/百度网盘/wechat/pages/chat/chat/chat.vue?c8aa","uni-app:///pages/chat/chat/chat.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,8F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAgnB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACuHpoB;;AAEA;AACA;AACA;AACA,iG;AACA;AACA,yBADA;AAEA;AACA,0BADA;AAEA,kCAFA;AAGA,8BAHA;AAIA,wBAJA;AAKA,kCALA,EAFA;;AASA,MATA,kBASA;AACA;AACA,wBADA;AAEA;AACA,kBAHA;AAIA;AACA;AACA;AACA,kBADA;AAEA,8CAFA;AAGA,4BAHA;AAIA;AACA,kBADA;AAEA,gDAFA;AAGA,4BAHA,EAJA;AAQA;AACA,kBADA;AAEA,kDAFA;AAGA,yBAHA,EARA;AAYA;AACA,kBADA;AAEA,8CAFA;AAGA,yBAHA,EAZA;AAgBA;AACA,oBADA;AAEA,gDAFA;AAGA,iBAHA,EAhBA;AAoBA;AACA,kBADA;AAEA,+CAFA;AAGA,iBAHA,EApBA,CADA,CALA;;;AAgCA,sBAhCA;AAiCA;AACA,uBAlCA;AAmCA,mBAnCA;AAoCA,qBApCA;AAqCA,cArCA;AAsCA;AACA,mBAvCA;AAwCA;AACA,cAzCA;;AA2CA;AACA,wBA5CA;AA6CA,wBA7CA;AA8CA;AACA,qBA/CA;;AAiDA;AACA,aADA;AAEA,gBAFA;AAGA,kBAHA;AAIA,yBAJA,EAjDA;;;AAwDA,GAlEA;AAmEA,SAnEA,qBAmEA;AACA;;;;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAPA;;;AAUA;AACA;AACA;AACA;AACA,gCADA;;AAGA;AACA,KANA;;AAQA;AACA,GA/FA;AAgGA;AACA;AACA,oEADA;AAEA,+DAFA;AAGA,2EAHA;AAIA,wDAJA;AAKA,sFALA;AAMA,wDANA,GADA;;AASA;AACA,mBAVA,6BAUA;AACA;AACA;AACA;AACA;AACA;AACA,KAhBA;AAiBA;AACA,cAlBA,wBAkBA;AACA;AACA,KApBA;AAqBA;AACA,kBAtBA,4BAsBA;AACA;AACA;AACA,KAzBA;AA0BA;AACA,iBA3BA,2BA2BA;AACA;AACA,KA7BA;AA8BA;AACA,YA/BA,sBA+BA;AACA;AACA;AACA;AACA;AACA,KApCA;AAqCA;AACA,kBAtCA,4BAsCA;AACA;AACA,KAxCA;AAyCA;AACA,wBA1CA,kCA0CA;AACA;AACA,KA5CA;AA6CA;AACA,aA9CA,uBA8CA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;AACA,KAtDA,GAhGA;;AAwJA;AACA,QADA,gBACA,QADA,EACA,QADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KARA,EAxJA;;AAkKA,QAlKA,kBAkKA,CAlKA,EAkKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GArLA;AAsLA,WAtLA,uBAsLA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GA/LA;AAgMA;AACA,gDADA;AAEA,cAFA,sBAEA,CAFA,EAEA;AACA;AACA;AACA;AACA,KANA;AAOA,iBAPA,2BAOA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAbA;AAcA,aAdA,qBAcA,OAdA,EAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA5BA;AA6BA,UA7BA,oBA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,2DAFA;AAGA,iCAHA;;AAKA;AACA;AACA;AACA;AACA;AACA,wCADA;AAEA,6BAFA;AAGA,iCAHA;AAIA,qCAJA;AAKA,sFALA;;AAOA,KAzDA;AA0DA;AACA,wBA3DA,kCA2DA;AACA;AACA;;AAEA;AACA;AACA,KAjEA;AAkEA;AACA,QAnEA,gBAmEA,IAnEA,EAmEA;AACA;AACA;AACA;AACA;AACA,gBAHA;;AAKA;AACA,kBADA;AAEA,kBAFA;AAGA,wBAHA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OALA,EAKA,KALA,CAKA;AACA;AACA;AACA;AACA,OATA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA,KA1GA;AA2GA;AACA,gBA5GA,0BA4GA;;;;;;;;;AASA;AACA;AACA;AACA,OAHA,EAGA,GAHA;;AAKA,KA1HA;AA2HA;AACA,QA5HA,sBA4HA;AACA;AACA;AACA;AACA;AACA,qBADA;AAEA,+BAFA;AAGA;AACA,kBADA;AAEA,qBAFA,EAHA;AAMA;AACA,kBADA;AAEA,uBAFA,EANA;;AAUA;AACA;AACA;AACA;AACA,oBADA;AAEA,iCAFA;;AAIA;;AAEA;AACA;AACA,oBADA;AAEA,uBAFA;;AAIA;;AAEA;AACA;AACA;AACA,KA7JA;AA8JA;AACA,cA/JA,sBA+JA,KA/JA,EA+JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;AAGA;AACA;AACA;AACA,4FADA;;AAGA;AACA;AACA;AACA,2BADA;AAEA;AACA;AACA,6BADA;AAEA,4BAFA;;AAIA,aAPA;;AASA;AACA;AACA;AACA,gCADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCADA;AAEA,oDAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAXA;AAYA;AACA,aArBA;;AAuBA;AACA;AACA;AACA,+BADA;AAEA;AACA;AACA;AACA,iCADA;AAEA,iCAFA;AAGA,uDAHA;AAIA,oBAJA,CAIA;AACA;AACA,mCADA;AAEA,gCAFA;;AAIA,iBATA;AAUA;AACA,aAfA;;AAiBA,gBAlEA;;AAoEA;AACA;AACA,KAxOA;AAyOA;AACA,eA1OA,uBA0OA,CA1OA,EA0OA;AACA;AACA;AACA;AACA,oBADA;AAEA;AACA;AACA;AACA;AACA;AACA,eAFA;AAGA,aARA;;AAUA;AACA;AACA;AACA,2BADA;AAEA;AACA;AACA;AACA;AACA;AACA,aAPA;;AASA;AACA;AACA;AACA;AACA;AACA;AACA,+CADA;;AAGA;AACA;AACA;AACA,6DADA;;AAGA,gBApCA;;AAsCA,KAjRA;AAkRA;AACA,aAnRA,uBAmRA;AACA;AACA,KArRA;AAsRA;AACA,gBAvRA,wBAuRA,GAvRA,EAuRA;AACA;AACA,oBADA;AAEA,4BAFA;AAGA,4BAHA;;AAKA,KA7RA;AA8RA;AACA,qBA/RA,+BA+RA;AACA;AACA,KAjSA;AAkSA;AACA;AACA,mBApSA,2BAoSA,CApSA,EAoSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBADA;;AAGA,KA7SA;AA8SA;AACA,iBA/SA,2BA+SA;AACA;AACA;AACA;AACA,KAnTA;AAoTA;AACA,oBArTA,8BAqTA;AACA;AACA;AACA;AACA;AACA,KA1TA;AA2TA,kBA3TA,0BA2TA,CA3TA,EA2TA;AACA;AACA;AACA,KA9TA;AA+TA;AACA,eAhUA,yBAgUA;AACA;AACA;AACA,4BADA;AAEA,0CAFA,GADA;;;AAMA,KAvUA,GAhMA,E","file":"pages/chat/chat/chat.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=b179d31e&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=b179d31e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.mode = \"text\"\n    }\n\n    _vm.e1 = function($event) {\n      _vm.KeyboardHeight = 0\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\r\n\n\t\t<!-- 导航栏 -->\r\n\t\t<free-nav-bar :title=\"detail.name\" :noreadnum=\"totalNoreadnum\" showBack>\r\n\t\t\t<free-icon-button slot=\"right\" \r\n\t\t\t:icon=\"'\\ue6fd'\"\r\n\t\t\t@click=\"openChatSet\"></free-icon-button>\r\n\t\t</free-nav-bar>\r\n\t\t\r\n\t\t<!-- 聊天内容区域 -->\r\n\t\t<scroll-view scroll-y class=\"bg-light position-fixed left-0 right-0 px-3\" style=\"bottom: 105rpx;box-sizing: border-box;\" :style=\"chatBodyBottom\" :show-scrollbar=\"false\" :scroll-into-view=\"scrollIntoView\" :scroll-with-animation=\"true\"\r\n\t\t@click=\"clickPage\">\r\n\t\t\t\r\n\t\t\t<!-- 聊天信息列表组件 -->\r\n\t\t\t<view v-for=\"(item,index) in list\" :key=\"index\" \r\n\t\t\t:id=\"'chatItem_'+index\">\r\n\t\t\t\t<free-chat-item :item=\"item\" :index=\"index\" ref=\"chatItem\"\r\n\t\t\t\t:pretime=\" index > 0 ? list[index-1].create_time : 0\"\r\n\t\t\t\t@long=\"long\" @preview=\"previewImage\" \r\n\t\t\t\t:shownickname=\"currentChatItem.shownickname\"\r\n\t\t\t\t></free-chat-item>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t</scroll-view>\r\n\t\t\r\n\t\t<!-- #ifdef APP-PLUS-NVUE -->\r\n\t\t<div v-if=\"mode === 'action' || mode === 'emoticon'\"\r\n\t\tclass=\"position-fixed top-0 right-0 left-0\"\r\n\t\t:style=\"'bottom:'+maskBottom+'px;'\"\r\n\t\t@click=\"clickPage\"></div>\r\n\t\t<!-- #endif -->\r\n\t\t\r\n\t\t<!-- 底部输入框 -->\r\n\t\t<view class=\"position-fixed left-0 right-0 border-top flex align-center\" style=\"background-color: #F7F7F6;height: 105rpx;\" \r\n\t\t:style=\"'bottom:'+KeyboardHeight+'px;'\">\r\n\t\t\t<free-icon-button v-if=\"mode === 'audio'\" :icon=\"'\\ue607'\" @click=\"changeVoiceOrText\"></free-icon-button>\r\n\t\t\t<free-icon-button v-else :icon=\"'\\ue606'\" @click=\"changeVoiceOrText\"></free-icon-button>\r\n\t\t\t<view class=\"flex-1\">\r\n\t\t\t\t<view v-if=\"mode === 'audio'\" class=\"rounded flex align-center justify-center\" style=\"height: 80rpx;\" :class=\"isRecording?'bg-hover-light':'bg-white'\" @touchstart=\"voiceTouchStart\" @touchend=\"voiceTouchEnd\" @touchcancel=\"voiceTouchCancel\" @touchmove=\"voiceTouchMove\">\r\n\t\t\t\t\t<text class=\"font\">{{isRecording ? '松开 结束':'按住 说话'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<textarea v-else fixed class=\"bg-white rounded p-2 font-md\" style=\"height: 50rpx;max-width: 450rpx;\" :adjust-position=\"false\" v-model=\"text\" @focus=\"mode = 'text'\"/>\r\n\t\t\t</view>\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<free-icon-button :icon=\"'\\ue605'\"\r\n\t\t\t@click=\"openActionOrEmoticon('emoticon')\"></free-icon-button>\r\n\t\t\t<template v-if=\"text.length === 0\">\r\n\t\t\t\t<!-- 扩展菜单 -->\r\n\t\t\t\t<free-icon-button :icon=\"'\\ue603'\" \r\n\t\t\t\t@click=\"openActionOrEmoticon('action')\"></free-icon-button>\r\n\t\t\t</template>\r\n\t\t\t<view v-else class=\"flex-shrink\">\r\n\t\t\t\t<!-- 发送按钮 -->\r\n\t\t\t\t<free-main-button name=\"发送\" \r\n\t\t\t\t@click=\"send('text')\"></free-main-button>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t</view>\n\t\r\n\t<!-- 扩展菜单 -->\r\n\t<free-popup ref=\"action\" bottom transformOrigin=\"center bottom\" @hide=\"KeyboardHeight = 0\" :mask=\"false\">\r\n\t\t<view style=\"height: 580rpx;\" class=\"border-top border-light-secondary bg-light\">\r\n\t\t\t<swiper :indicator-dots=\"emoticonOrActionList.length > 1\" style=\"height: 510rpx;\">\r\n\t\t\t\t<swiper-item class=\"row\" \r\n\t\t\t\tv-for=\"(item,index) in emoticonOrActionList\"\r\n\t\t\t\t:key=\"index\">\r\n\t\t\t\t\t<view class=\"col-2 flex flex-column align-center justify-center\" style=\"width: 146rpx; height: 255rpx;\" v-for=\"(item2,index2) in item\" :key=\"index2\" @click=\"actionEvent(item2)\">\r\n\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\"\r\n\t\t\t\t\t\tstyle=\"width: 100rpx;height: 100rpx;\"></image>\r\n\t\t\t\t\t\t<text class=\"font-sm text-muted mt-2\"\r\n\t\t\t\t\t\t>{{item2.name}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t</view>\r\n\t</free-popup>\r\n\t\r\n\t\r\n\t<!-- 弹出层 -->\r\n\t<free-popup ref=\"extend\" :bodyWidth=\"240\" :bodyHeight=\"450\" :tabbarHeight=\"105\">\r\n\t\t<view class=\"flex flex-column\" \r\n\t\tstyle=\"width: 240rpx;\"\r\n\t\t:style=\"getMenusStyle\">\r\n\t\t\t<view class=\"flex-1 flex align-center\" \r\n\t\t\thover-class=\"bg-light\"\r\n\t\t\tv-for=\"(item,index) in menusList\"\r\n\t\t\t:key=\"index\"\r\n\t\t\t@click=\"clickEvent(item.event)\">\r\n\t\t\t\t<text class=\"font-md pl-3\">{{item.name}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</free-popup>\r\n\t\r\n\t\r\n\t<!-- 录音提示 -->\r\n\t<view v-if=\"isRecording\" class=\"position-fixed top-0 left-0 right-0 flex align-center justify-center\" style=\"bottom: 105rpx;\">\r\n\t\t<view style=\"width: 360rpx;height: 360rpx;background-color: rgba(0,0,0,0.5);\" class=\"rounded flex flex-column align-center justify-center\">\r\n\t\t\t<image src=\"/static/audio/recording.gif\" style=\"width: 150rpx;height: 150rpx;\"></image>\r\n\t\t\t<text class=\"font text-white mt-3\">{{unRecord ? '松开手指，取消发送':'手指上滑，取消发送'}}</text>\r\n\t\t</view>\r\n\t</view>\r\n\t\r\n\t</view>\n</template>\n\n<script>\r\n\t// #ifdef APP-PLUS-NVUE\r\n\tconst dom = weex.requireModule('dom')\r\n\t// #endif\r\n\t\r\n\timport freeNavBar from \"@/components/free-ui/free-nav-bar.vue\"\r\n\timport freeIconButton from \"@/components/free-ui/free-icon-button.vue\"\r\n\timport freeChatItem from '@/components/free-ui/free-chat-item.vue';\r\n\timport freePopup from \"@/components/free-ui/free-popup.vue\"\r\n\timport freeMainButton from '@/components/free-ui/free-main-button.vue';\r\n\t\r\n\t\r\n\timport { mapState,mapMutations } from 'vuex'\r\n\t\r\n\timport auth from '@/common/mixin/auth.js';\r\n\timport $U from '@/common/free-lib/util.js';\r\n\timport $H from '@/common/free-lib/request.js';\r\n\timport $C from '@/common/free-lib/config.js';\n\texport default {\r\n\t\tmixins:[auth],\r\n\t\tcomponents: {\r\n\t\t\tfreeNavBar,\r\n\t\t\tfreeIconButton,\r\n\t\t\tfreeChatItem,\r\n\t\t\tfreePopup,\r\n\t\t\tfreeMainButton\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tscrollIntoView:\"\",\r\n\t\t\t\t// 模式 text输入文字，emoticon表情，action操作，audio音频\r\n\t\t\t\tmode:\"text\",\r\n\t\t\t\t// 扩展菜单列表\r\n\t\t\t\tactionList:[\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\tname:\"相册\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/pic.png\",\r\n\t\t\t\t\t\tevent:\"uploadImage\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"拍摄\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/video.png\",\r\n\t\t\t\t\t\tevent:\"uploadVideo\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"收藏\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/shoucan.png\",\r\n\t\t\t\t\t\tevent:\"openFava\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"名片\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/man.png\",\r\n\t\t\t\t\t\tevent:\"sendCard\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"语音通话\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/phone.png\",\r\n\t\t\t\t\t\tevent:\"\"\r\n\t\t\t\t\t},{\r\n\t\t\t\t\t\tname:\"位置\",\r\n\t\t\t\t\t\ticon:\"/static/images/extends/path.png\",\r\n\t\t\t\t\t\tevent:\"\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t],\r\n\t\t\t\temoticonList:[],\r\n\t\t\t\t// 键盘高度\r\n\t\t\t\tKeyboardHeight:0,\r\n\t\t\t\tmenusList:[],\n\t\t\t\tnavBarHeight:0,\r\n\t\t\t\tlist:[],\r\n\t\t\t\t// 当前操作的气泡索引\r\n\t\t\t\tpropIndex:-1,\r\n\t\t\t\t// 输入文字\r\n\t\t\t\ttext:\"\",\r\n\t\t\t\t\r\n\t\t\t\t// 音频录制状态\r\n\t\t\t\tisRecording:false,\r\n\t\t\t\tRecordingStartY:0,\r\n\t\t\t\t// 取消录音\r\n\t\t\t\tunRecord:false,\r\n\t\t\t\t\r\n\t\t\t\tdetail:{\r\n\t\t\t\t\tid:0,\r\n\t\t\t\t\tname:\"\",\r\n\t\t\t\t\tavatar:\"\",\r\n\t\t\t\t\tchat_type:\"user\"\r\n\t\t\t\t}\n\t\t\t}\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tvar statusBarHeight = 0\r\n\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\tstatusBarHeight = plus.navigator.getStatusbarHeight()\r\n\t\t\t// #endif\r\n\t\t\tthis.navBarHeight = statusBarHeight + uni.upx2px(90)\r\n\t\t\t\r\n\t\t\t// 监听键盘高度变化\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t  if (this.mode !== 'action' && this.mode !== 'emoticon') {\r\n\t\t\t  \tthis.KeyboardHeight = res.height \r\n\t\t\t  }\r\n\t\t\t  if (this.KeyboardHeight > 0) {\r\n\t\t\t  \tthis.pageToBottom()\r\n\t\t\t  }\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// 注册发送音频事件\r\n\t\t\tthis.regSendVoiceEvent((url)=>{\r\n\t\t\t\tif (!this.unRecord) {\r\n\t\t\t\t\tthis.send('audio',url,{\r\n\t\t\t\t\t\ttime:this.RecordTime\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\tthis.pageToBottom()\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\r\n\t\t\t\tchatList:state=>state.user.chatList,\r\n\t\t\t\tRECORD:state=>state.audio.RECORD,\r\n\t\t\t\tRecordTime:state=>state.audio.RecordTime,\r\n\t\t\t\tchat:state=>state.user.chat,\r\n\t\t\t\ttotalNoreadnum:state=>state.user.totalNoreadnum,\r\n\t\t\t\tuser:state=>state.user.user\r\n\t\t\t}),\r\n\t\t\t// 当前会话配置信息\r\n\t\t\tcurrentChatItem(){\r\n\t\t\t\tlet index = this.chatList.findIndex(item=>item.id === this.detail.id && item.chat_type === this.detail.chat_type)\r\n\t\t\t\tif(index !== -1){\r\n\t\t\t\t\treturn this.chatList[index]\r\n\t\t\t\t}\r\n\t\t\t\treturn {}\r\n\t\t\t},\r\n\t\t\t// 获取蒙版的位置\r\n\t\t\tmaskBottom(){\r\n\t\t\t\treturn this.KeyboardHeight + uni.upx2px(105)\r\n\t\t\t},\r\n\t\t\t// 动态获取菜单高度\r\n\t\t\tgetMenusHeight(){\r\n\t\t\t\tlet H = 100\r\n\t\t\t\treturn this.menusList.length * H\r\n\t\t\t},\r\n\t\t\t// 获取菜单的样式\r\n\t\t\tgetMenusStyle(){\r\n\t\t\t\treturn `height: ${this.getMenusHeight}rpx;`\r\n\t\t\t},\r\n\t\t\t// 判断是否操作本人信息\r\n\t\t\tisdoSelf(){\r\n\t\t\t\t// 获取本人id（假设拿到了）\r\n\t\t\t\tlet id = 1\r\n\t\t\t\tlet user_id = this.propIndex > -1 ? this.list[this.propIndex].user_id : 0\r\n\t\t\t\treturn user_id === id\r\n\t\t\t},\r\n\t\t\t// 聊天区域bottom\r\n\t\t\tchatBodyBottom(){\r\n\t\t\t\treturn `bottom:${uni.upx2px(105) + this.KeyboardHeight}px;top:${this.navBarHeight}px;`\r\n\t\t\t},\r\n\t\t\t// 获取操作或者表情列表\r\n\t\t\temoticonOrActionList(){\r\n\t\t\t\treturn (this.mode === 'emoticon' || this.mode === 'action') ? this[this.mode+'List'] : []\r\n\t\t\t},\r\n\t\t\t// 所有信息的图片地址\r\n\t\t\timageList(){\r\n\t\t\t\tlet arr = []\r\n\t\t\t\tthis.list.forEach((item)=>{\r\n\t\t\t\t\tif (item.type === 'emoticon' || item.type === 'image') {\r\n\t\t\t\t\t\tarr.push(item.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn arr\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tmode(newValue, oldValue) {\r\n\t\t\t\tif (newValue !== 'action' && newValue !== 'emoticon') {\r\n\t\t\t\t\tthis.$refs.action.hide()\r\n\t\t\t\t}\r\n\t\t\t\tif (newValue !== 'text') {\r\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif(!e.params){\r\n\t\t\t\treturn this.backToast()\r\n\t\t\t}\r\n\t\t\tthis.detail = JSON.parse(decodeURIComponent(e.params))\r\n\t\t\t//console.log(this.detail);\r\n\t\t\t// 初始化\r\n\t\t\tthis.__init()\r\n\t\t\t// 创建聊天对象\r\n\t\t\tthis.chat.createChatObject(this.detail)\r\n\t\t\t// 获取历史记录\r\n\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t// 监听接收聊天信息\r\n\t\t\tuni.$on('onMessage',this.onMessage)\r\n\t\t\t\r\n\t\t\tuni.$on('updateHistory',this.updateHistory)\r\n\t\t\t\r\n\t\t\t// 监听发送收藏和名片\r\n\t\t\tuni.$on('sendItem',this.onSendItem)\r\n\t\t},\r\n\t\tdestroyed() {\r\n\t\t\t// 销毁聊天对象\r\n\t\t\tthis.chat.destoryChatObject()\r\n\t\t\t// 销毁监听接收聊天消息\r\n\t\t\tuni.$off('onMessage',this.onMessage)\r\n\t\t\t\r\n\t\t\tuni.$off('updateHistory',this.updateHistory)\r\n\t\t\t\r\n\t\t\tuni.$off('sendItem',this.onSendItem)\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t...mapMutations(['regSendVoiceEvent']),\r\n\t\t\tonSendItem(e){\r\n\t\t\t\tif(e.sendType === 'fava' || e.sendType === 'card'){\r\n\t\t\t\t\tthis.send(e.type,e.data,e.options)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateHistory(isclear = true){\r\n\t\t\t\tif(isclear){\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.list = this.chat.getChatDetail()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonMessage(message){\r\n\t\t\t\t//console.log('[聊天页] 监听接收聊天信息',message);\r\n\t\t\t\tif((message.from_id === this.detail.id && message.chat_type === 'user') || (message.chat_type === 'group' && message.to_id === this.detail.id)){\r\n\t\t\t\t\tif(message.isremove !== 1){\r\n\t\t\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\t\t// 置于底部\r\n\t\t\t\t\t\treturn this.pageToBottom()\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 撤回消息\r\n\t\t\t\t\tlet index = this.list.findIndex(item=>item.id === message.id)\r\n\t\t\t\t\tif(index !== -1){\r\n\t\t\t\t\t\tthis.list[index].isremove = 1\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t__init(){\r\n\t\t\t\tvar total = 20\r\n\t\t\t\tvar page = Math.ceil(total/8)\r\n\t\t\t\tvar arr = []\r\n\t\t\t\tfor (var i = 0; i < page; i++) {\r\n\t\t\t\t\tvar start = i*8\r\n\t\t\t\t\tarr[i] = []\r\n\t\t\t\t\tfor (var j = 0; j < 8; j++) {\r\n\t\t\t\t\t\tvar no = start + j\r\n\t\t\t\t\t\tif ((no+1) > total) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarr[i].push({\r\n\t\t\t\t\t\t\tname:\"表情\"+no,\r\n\t\t\t\t\t\t\ticon: $C.emoticonUrl + no +'.gif',\r\n\t\t\t\t\t\t\tevent:\"sendEmoticon\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.emoticonList = arr\r\n\t\t\t\t// 初始化会话列表\r\n\t\t\t\tthis.chat.initChatListItem({\r\n\t\t\t\t\tchat_type:this.detail.chat_type,\r\n\t\t\t\t\tto_id:this.detail.id,\r\n\t\t\t\t\tto_name:this.detail.name,\r\n\t\t\t\t\tto_avatar:this.detail.avatar,\r\n\t\t\t\t\tdata:this.detail.chat_type === 'user' ? '你们已经是好友，可以开始聊天了' : '你已经加入群聊，可以开始聊天了'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 打开扩展菜单或者表情包\r\n\t\t\topenActionOrEmoticon(mode = 'action'){\r\n\t\t\t\tthis.mode = mode\r\n\t\t\t\tthis.$refs.action.show()\r\n\t\t\t\t\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.KeyboardHeight = uni.upx2px(580)\r\n\t\t\t},\r\n\t\t\t// 发送\r\n\t\t\tsend(type, data = '',options = {}){\r\n\t\t\t\t// 组织数据格式\r\n\t\t\t\tswitch (type){\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\tdata = data || this.text\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet message = this.chat.formatSendData({\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\toptions\r\n\t\t\t\t})\r\n\t\t\t\t// 渲染到页面\r\n\t\t\t\tlet index = this.list.length\r\n\t\t\t\tthis.list.push(message)\r\n\t\t\t\t// 监听上传进度\r\n\t\t\t\tlet onProgress = false\r\n\t\t\t\tif(message.type !== 'text' && message.type !== 'emoticon' && message.type !== 'card' && !message.data.startsWith('http')){\r\n\t\t\t\t\tonProgress = (progress)=>{\r\n\t\t\t\t\t\t//console.log('上传进度：',progress);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 发送到服务端\r\n\t\t\t\tthis.chat.send(message,onProgress).then(res=>{\r\n\t\t\t\t\t//console.log(res);\r\n\t\t\t\t\t// 发送成功\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\t// 发送失败\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t\t//console.log(err);\r\n\t\t\t\t})\r\n\t\t\t\t// 发送文字成功，清空输入框\r\n\t\t\t\tif (type === 'text') {\r\n\t\t\t\t\tthis.text = ''\r\n\t\t\t\t}\r\n\t\t\t\t// 置于底部\r\n\t\t\t\tthis.pageToBottom()\r\n\t\t\t},\r\n\t\t\t// 回到底部\r\n\t\t\tpageToBottom(){\r\n\t\t\t\t// #ifdef APP-PLUS-NVUE\r\n\t\t\t\tlet chatItem = this.$refs.chatItem\r\n\t\t\t\tlet lastIndex = chatItem.length > 0 ? chatItem.length - 1 : 0\r\n\t\t\t\tif (chatItem[lastIndex]) {\r\n\t\t\t\t\tdom.scrollToElement(chatItem[lastIndex],{})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef APP-NVUE\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tlet lastIndex = this.list.length - 1\r\n\t\t\t\t\tthis.scrollIntoView = 'chatItem_'+lastIndex\r\n\t\t\t\t},300)\r\n\t\t\t\t// #endif\r\n\t\t\t},\n\t\t\t// 长按消息气泡\r\n\t\t\tlong({x,y,index}){\r\n\t\t\t\t// 初始化 索引\r\n\t\t\t\tthis.propIndex = index\r\n\t\t\t\t// 组装菜单\r\n\t\t\t\tlet menus = [{ \r\n\t\t\t\t\tname:\"发送给朋友\",\r\n\t\t\t\t\tevent:'sendToChatItem'\r\n\t\t\t\t},{ \r\n\t\t\t\t\tname:\"收藏\",\r\n\t\t\t\t\tevent:'fava'\r\n\t\t\t\t},{ \r\n\t\t\t\t\tname:\"删除\",\r\n\t\t\t\t\tevent:'delete'\r\n\t\t\t\t}]\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tif(isSelf){\r\n\t\t\t\t\tmenus.push({\r\n\t\t\t\t\t\tname:\"撤回\",\r\n\t\t\t\t\t\tevent:'removeChatItem'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\tif(item.type === 'text'){\r\n\t\t\t\t\tmenus.unshift({\r\n\t\t\t\t\t\tname:\"复制\",\r\n\t\t\t\t\t\tevent:'copy',\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\tthis.menusList = menus\r\n\t\t\t\t// 显示扩展菜单\r\n\t\t\t\tthis.$refs.extend.show(x,y)\r\n\t\t\t},\r\n\t\t\t// 操作菜单方法分发\r\n\t\t\tclickEvent(event){\r\n\t\t\t\tlet item = this.list[this.propIndex]\r\n\t\t\t\tlet isSelf = this.user.id === item.from_id\r\n\t\t\t\tswitch (event){\r\n\t\t\t\t\tcase 'removeChatItem': // 撤回消息\r\n\t\t\t\t\t// 拿到当前被操作的信息\r\n\t\t\t\t\tthis.chat.recall(item).then(res=>{\r\n\t\t\t\t\t\titem.isremove = 1\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendToChatItem':\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '../chat-list/chat-list?params='+encodeURIComponent(JSON.stringify(item)),\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'copy': // 复制\r\n\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t    data: item.data,\r\n\t\t\t\t\t    success: ()=> {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '复制成功',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: '是否要删除该记录？',\r\n\t\t\t\t\t\tsuccess: (res)=> {\r\n\t\t\t\t\t\t\tif (!res.confirm) return;\r\n\t\t\t\t\t\t\tthis.chat.deleteChatDetailItem(item,isSelf)\r\n\t\t\t\t\t\t\tthis.list.splice(this.propIndex,1)\r\n\t\t\t\t\t\t\t// 删除最后一条消息\r\n\t\t\t\t\t\t\tif(this.list.length === this.propIndex){\r\n\t\t\t\t\t\t\t\tthis.chat.updateChatItem({\r\n\t\t\t\t\t\t\t\t\tid:this.detail.id,\r\n\t\t\t\t\t\t\t\t\tchat_type:this.detail.chat_type\r\n\t\t\t\t\t\t\t\t},(v)=>{\r\n\t\t\t\t\t\t\t\t\tlet o = this.list[this.propIndex - 1]\r\n\t\t\t\t\t\t\t\t\tlet data = ''\r\n\t\t\t\t\t\t\t\t\tif(o){\r\n\t\t\t\t\t\t\t\t\t\tdata = this.chat.formatChatItemData(o,isSelf)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tv.data = data\r\n\t\t\t\t\t\t\t\t\treturn v\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'fava': // 加入收藏\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: '是否要加入收藏？',\r\n\t\t\t\t\t\tsuccess: (res)=> {\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t$H.post('/fava/create',{\r\n\t\t\t\t\t\t\t\t\ttype:item.type,\r\n\t\t\t\t\t\t\t\t\tdata:item.data,\r\n\t\t\t\t\t\t\t\t\toptions:JSON.stringify(item.options)\r\n\t\t\t\t\t\t\t\t}).then(res=>{\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '加入收藏成功',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t// 关闭菜单\r\n\t\t\t\tthis.$refs.extend.hide()\r\n\t\t\t},\r\n\t\t\t// 扩展菜单\r\n\t\t\tactionEvent(e){\r\n\t\t\t\tswitch (e.event){\r\n\t\t\t\t\tcase 'uploadImage': // 选择相册\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount:9,\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t// 发送到服务器\r\n\t\t\t\t\t\t\t// 渲染到页面\r\n\t\t\t\t\t\t\tres.tempFilePaths.forEach((item)=>{\r\n\t\t\t\t\t\t\t\tthis.send('image',item)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'uploadVideo': // 发送短视频\r\n\t\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\t\tmaxDuration:10,\r\n\t\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\t\tthis.send('video',res.tempFilePath)\r\n\t\t\t\t\t\t\t// 渲染页面\r\n\t\t\t\t\t\t\t// 发送到服务端（获取视频封面，返回url）\r\n\t\t\t\t\t\t\t// 修改本地的发送状态\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendEmoticon': // 发送表情包\r\n\t\t\t\t\tthis.send('emoticon',e.icon)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'openFava': // 发送收藏\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '../../my/fava/fava?type=send',\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendCard': // 发送名片\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '../../mail/mail/mail?type=sendCard&limit=1',\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 点击页面\r\n\t\t\tclickPage(){\r\n\t\t\t\tthis.mode = ''\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tpreviewImage(url){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent:url,\r\n\t\t\t\t\turls:this.imageList,\r\n\t\t\t\t\tindicator:\"default\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 切换音频录制和文本输入\r\n\t\t\tchangeVoiceOrText(){\r\n\t\t\t\tthis.mode = this.mode !== 'audio' ? 'audio' : 'text'\r\n\t\t\t},\r\n\t\t\t// 录音相关\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceTouchStart(e){ \r\n\t\t\t\t// 初始化\r\n\t\t\t\tthis.isRecording = true\r\n\t\t\t\tthis.RecordingStartY = e.changedTouches[0].screenY\r\n\t\t\t\tthis.unRecord = false\r\n\t\t\t\t// 开始录音\r\n\t\t\t\tthis.RECORD.start({\r\n\t\t\t\t\tformat:\"mp3\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 录音结束\r\n\t\t\tvoiceTouchEnd(){\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceTouchCancel(){\r\n\t\t\t\tthis.isRecording = false\r\n\t\t\t\tthis.unRecord = true\r\n\t\t\t\t// 停止录音\r\n\t\t\t\tthis.RECORD.stop()\r\n\t\t\t},\r\n\t\t\tvoiceTouchMove(e){\r\n\t\t\t\tlet Y = Math.abs(e.changedTouches[0].screenY - this.RecordingStartY)\r\n\t\t\t\tthis.unRecord = (Y >= 50)\r\n\t\t\t},\r\n\t\t\t// 打开聊天信息设置\r\n\t\t\topenChatSet(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../chat-set/chat-set?params='+JSON.stringify({\r\n\t\t\t\t\t\tid:this.detail.id,\r\n\t\t\t\t\t\tchat_type:this.detail.chat_type\r\n\t\t\t\t\t}),\r\n\t\t\t\t});\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n"],"sourceRoot":""}